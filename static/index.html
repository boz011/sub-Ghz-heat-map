<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LPWAN Simulator</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
            display:flex; height:100vh;
            background:#1e1e1e; color:#e0e0e0; overflow:hidden;
        }
        #left-panel {
            width:260px; min-width:260px; background:#2d2d2d;
            padding:16px; overflow-y:auto; border-right:1px solid #444;
        }
        #main-area { flex:1; display:flex; flex-direction:column; min-width:0; }
        #toolbar {
            background:#2d2d2d; padding:8px 16px; border-bottom:1px solid #444;
            display:flex; gap:8px; align-items:center; flex-wrap:wrap; flex-shrink:0;
        }
        #canvas-container {
            flex:1; position:relative; overflow:scroll; background:#1a1a1a; min-height:0;
        }
        #map-container {
            position:absolute; top:0; left:0; z-index:0; display:none; pointer-events:none;
        }
        #grid-canvas { display:block; cursor:crosshair; position:relative; z-index:1; }
        #right-panel {
            width:300px; min-width:300px; background:#2d2d2d;
            padding:16px; overflow-y:auto; border-left:1px solid #444;
        }
        .palette-section { margin-bottom:18px; padding-bottom:12px; border-bottom:1px solid #444; }
        .palette-section h3 { font-size:12px; margin-bottom:8px; color:#888; text-transform:uppercase; letter-spacing:.5px; }
        .device-btn,.obstacle-btn {
            display:block; width:100%; padding:7px 8px; margin-bottom:4px;
            background:#3a3a3a; border:1px solid #555; color:#e0e0e0;
            cursor:pointer; border-radius:4px; font-size:12px; transition:all .15s; text-align:left;
        }
        .device-btn:hover,.obstacle-btn:hover { background:#4a4a4a; }
        .device-btn.active,.obstacle-btn.active { background:#0066cc; border-color:#0088ff; }
        button { padding:7px 14px; background:#0066cc; border:none; color:white; cursor:pointer; border-radius:4px; font-size:12px; }
        button:hover { background:#0088ff; }
        button.danger { background:#cc3333; }
        button.danger:hover { background:#ff4444; }
        input[type="number"],select { padding:5px; background:#3a3a3a; border:1px solid #555; color:#e0e0e0; border-radius:4px; width:70px; font-size:11px; }
        select { width:auto; min-width:80px; }
        label { font-size:11px; color:#888; margin-right:4px; }
        .stats-section { margin-bottom:16px; }
        .stats-section h3 { font-size:13px; margin-bottom:8px; color:#0088ff; text-transform:uppercase; letter-spacing:.5px; }
        .stat-row { display:flex; justify-content:space-between; padding:4px 0; font-size:11px; border-bottom:1px solid #3a3a3a; }
        .stat-label { color:#888; }
        .stat-value { color:#e0e0e0; font-weight:bold; }
        .legend { margin-top:14px; }
        .legend h3 { font-size:12px; margin-bottom:6px; color:#0088ff; }
        .legend-item { display:flex; align-items:center; margin-bottom:6px; font-size:10px; }
        .legend-color { width:16px; height:16px; margin-right:6px; border:1px solid #555; border-radius:2px; }
        #status {
            position:absolute; top:8px; left:8px;
            background:rgba(0,0,0,.85); padding:6px 10px; border-radius:4px;
            font-size:11px; color:#0088ff; z-index:10; pointer-events:none;
        }
        .config-panel {
            background:#333; border:1px solid #555; border-radius:4px;
            padding:8px; margin-top:6px; display:none;
        }
        .config-panel.open { display:block; }
        .config-panel label { display:block; margin:4px 0 2px; }
        .config-panel select,.config-panel input { width:100%; margin-bottom:4px; }
        .config-toggle {
            font-size:10px; color:#0088ff; cursor:pointer; margin-left:6px;
        }
        .config-toggle:hover { text-decoration:underline; }
        .freq-display { font-size:10px; color:#aaa; padding:2px 0; }
        .material-selector { display:none; padding:4px 0; }
        .material-selector.active { display:block; }
    </style>
</head>
<body>
    <div id="left-panel">
        <div class="palette-section">
            <h3>üõú Wi-Fi HaLow <span class="config-toggle" data-panel="halow-config">‚öô Config</span></h3>
            <button class="device-btn" data-type="halow_ap" data-color="#00ffff">Access Point</button>
            <button class="device-btn" data-type="halow_endpoint" data-color="#00aaaa">Endpoint</button>
            <div class="config-panel" id="halow-config">
                <label>Channel Width:</label>
                <select id="halow-chwidth">
                    <option value="1">1 MHz</option>
                    <option value="2" selected>2 MHz</option>
                    <option value="4">4 MHz</option>
                </select>
                <label>Channel:</label>
                <select id="halow-channel"></select>
                <div class="freq-display" id="halow-freq">Center: 903.0 MHz</div>
                <label>Elevation (m):</label>
                <input type="number" id="halow-elevation" value="3" min="1" max="100" step="1">
            </div>
        </div>

        <div class="palette-section">
            <h3>üì° LoRaWAN <span class="config-toggle" data-panel="lorawan-config">‚öô Config</span></h3>
            <button class="device-btn" data-type="lorawan_gateway" data-color="#ff00ff">Gateway</button>
            <button class="device-btn" data-type="lorawan_endpoint" data-color="#aa00aa">Endpoint</button>
            <div class="config-panel" id="lorawan-config">
                <label>Region:</label>
                <select id="lora-region">
                    <option value="US915" selected>US915</option>
                    <option value="EU868">EU868</option>
                </select>
                <label>Bandwidth:</label>
                <select id="lora-bw">
                    <option value="125" selected>125 kHz</option>
                    <option value="250">250 kHz</option>
                    <option value="500">500 kHz</option>
                </select>
                <label>Spreading Factor:</label>
                <select id="lora-sf">
                    <option value="7">SF7</option>
                    <option value="8">SF8</option>
                    <option value="9">SF9</option>
                    <option value="10">SF10</option>
                    <option value="11">SF11</option>
                    <option value="12" selected>SF12</option>
                </select>
                <div class="freq-display" id="lora-datarate">Data Rate: ~0.3 kbps</div>
                <label>Elevation (m):</label>
                <input type="number" id="lorawan-elevation" value="15" min="1" max="200" step="1">
            </div>
        </div>

        <div class="palette-section">
            <h3>üì∂ NB-IoT</h3>
            <button class="device-btn" data-type="nbiot_base" data-color="#ffaa00">Cellular Module</button>
            <button class="device-btn" data-type="nbiot_endpoint" data-color="#aa6600">Endpoint</button>
        </div>

        <div class="palette-section">
            <h3>üß± Obstacles</h3>
            <button class="obstacle-btn" data-type="wall">Wall</button>
            <div class="material-selector" id="wall-material">
                <label>Material:</label>
                <select id="wall-mat">
                    <option value="wood">Wood (4dB)</option>
                    <option value="glass">Glass (3dB)</option>
                    <option value="cement">Cement (12dB)</option>
                    <option value="metal">Metal (25dB)</option>
                </select>
            </div>
            <button class="obstacle-btn" data-type="house">House</button>
            <button class="obstacle-btn" data-type="water">Water Pond</button>
            <button class="obstacle-btn" data-type="forest">Forest</button>
            <button class="obstacle-btn" data-type="water_tower">Water Tower</button>
        </div>

        <div class="palette-section">
            <h3>‚ö° Interferers</h3>
            <button class="device-btn" data-type="power_meter" data-color="#ff3333">Power Meter (900‚Äì950 MHz)</button>
        </div>

        <div class="palette-section">
            <h3>üîß Tools</h3>
            <button id="measure-tool" class="obstacle-btn">üìè Measure Distance</button>
        </div>

        <div class="palette-section">
            <h3>üéõ Display</h3>
            <label style="display:block;font-size:12px;margin:4px 0;color:#e0e0e0;cursor:pointer">
                <input type="checkbox" id="toggle-halow" checked> Show HaLow Coverage
            </label>
            <label style="display:block;font-size:12px;margin:4px 0;color:#e0e0e0;cursor:pointer">
                <input type="checkbox" id="toggle-lorawan" checked> Show LoRaWAN Coverage
            </label>
            <label style="display:block;font-size:12px;margin:4px 0;color:#e0e0e0;cursor:pointer">
                <input type="checkbox" id="toggle-nbiot" checked> Show NB-IoT Coverage
            </label>
            <label style="display:block;font-size:12px;margin:4px 0;color:#e0e0e0;cursor:pointer">
                <input type="checkbox" id="toggle-interference" checked> Show Interference
            </label>
            <label style="display:block;font-size:12px;margin:4px 0;color:#e0e0e0;cursor:pointer">
                <input type="checkbox" id="toggle-obstacles-att" checked> Obstacle Signal Loss
            </label>
            <label style="display:block;font-size:12px;margin:4px 0;color:#e0e0e0;cursor:pointer">
                <input type="checkbox" id="toggle-shadow-fading" checked> Shadow Fading (œÉ=4dB)
            </label>
            <label style="display:block;font-size:12px;margin:4px 0;color:#e0e0e0;cursor:pointer">
                <input type="checkbox" id="toggle-multipath-fading"> Multipath Fading (Rayleigh)
            </label>
        </div>
    </div>

    <div id="main-area">
        <div id="toolbar">
            <label>Grid:</label>
            <input type="number" id="grid-width" value="1" min="1" max="50" step="1">
            <span>√ó</span>
            <input type="number" id="grid-height" value="1" min="1" max="50" step="1">
            <label>km</label>

            <label style="margin-left:10px">Res:</label>
            <input type="number" id="resolution" value="10" min="10" max="500" step="10">
            <label>m</label>

            <label style="margin-left:10px">Env:</label>
            <select id="env-type">
                <option value="urban" selected>Urban (n=2.7)</option>
                <option value="rural">Rural (n=2.0)</option>
                <option value="suburban">Suburban (n=2.4)</option>
            </select>

            <label style="margin-left:10px">Zoom:</label>
            <span id="zoom-level" style="min-width:36px">100%</span>

            <label style="margin-left:10px">Grid:</label>
            <input type="range" id="grid-opacity" min="5" max="100" value="80" style="width:80px;vertical-align:middle">

            <button id="run-sim" style="margin-left:auto">‚ñ∂ Run Simulation</button>
            <button id="toggle-prop">Propagation</button>
            <button id="toggle-map">üó∫ Map</button>
            <button id="clear-all" class="danger">Clear All</button>

            <div id="map-controls" style="display:none; margin-left:8px; gap:4px; align-items:center; flex-wrap:wrap;">
                <label>Lat:</label>
                <input type="number" id="map-lat" value="30.2672" step="0.0001" style="width:90px">
                <label>Lng:</label>
                <input type="number" id="map-lng" value="-97.7431" step="0.0001" style="width:90px">
                <select id="map-layer" style="min-width:90px">
                    <option value="street">Street Map</option>
                    <option value="satellite">Satellite</option>
                </select>
                <button id="map-apply" style="padding:5px 8px">Apply</button>
            </div>
        </div>

        <div id="canvas-container">
            <div id="map-container"></div>
            <canvas id="grid-canvas"></canvas>
            <div id="status">Ready ‚Äî select a device or obstacle to place</div>
        </div>
    </div>

    <div id="right-panel">
        <div class="stats-section">
            <h3>üìä Coverage Stats</h3>
            <div id="coverage-stats">
                <div class="stat-row"><span class="stat-label">Coverage:</span><span class="stat-value" id="stat-coverage">‚Äî</span></div>
                <div class="stat-row"><span class="stat-label">Mean RSSI:</span><span class="stat-value" id="stat-rssi">‚Äî</span></div>
                <div class="stat-row"><span class="stat-label">Mean SNR:</span><span class="stat-value" id="stat-snr">‚Äî</span></div>
                <div class="stat-row"><span class="stat-label">Grid points:</span><span class="stat-value" id="stat-points">‚Äî</span></div>
            </div>
            <div id="per-tech-stats" style="margin-top:8px"></div>
        </div>

        <div class="stats-section">
            <h3>üìç Device Count</h3>
            <div id="device-stats"></div>
        </div>

        <div class="legend">
            <h3>üõú HaLow Coverage</h3>
            <div class="legend-item"><div class="legend-color" style="background:#00e5e5"></div><span>Excellent (&gt;‚àí65 dBm)</span></div>
            <div class="legend-item"><div class="legend-color" style="background:#00b3b3"></div><span>Good (‚àí65 to ‚àí75)</span></div>
            <div class="legend-item"><div class="legend-color" style="background:#008080"></div><span>Fair (‚àí75 to ‚àí85)</span></div>
            <div class="legend-item"><div class="legend-color" style="background:rgb(0,50,80)"></div><span>Poor (&lt;‚àí85)</span></div>
        </div>
        <div class="legend" style="margin-top:10px">
            <h3>üì° LoRaWAN Coverage</h3>
            <div class="legend-item"><div class="legend-color" style="background:#ff44ff"></div><span>Excellent (&gt;‚àí100 dBm)</span></div>
            <div class="legend-item"><div class="legend-color" style="background:rgb(180,0,180)"></div><span>Good (‚àí100 to ‚àí120)</span></div>
            <div class="legend-item"><div class="legend-color" style="background:rgb(100,0,100)"></div><span>Fair (‚àí120 to ‚àí130)</span></div>
            <div class="legend-item"><div class="legend-color" style="background:rgb(40,0,40)"></div><span>Poor (&lt;‚àí130)</span></div>
        </div>
        <div class="legend" style="margin-top:10px">
            <h3>üì∂ NB-IoT Coverage</h3>
            <div class="legend-item"><div class="legend-color" style="background:#ffbb33"></div><span>Excellent (&gt;‚àí90 dBm)</span></div>
            <div class="legend-item"><div class="legend-color" style="background:#dd8800"></div><span>Good (‚àí90 to ‚àí110)</span></div>
            <div class="legend-item"><div class="legend-color" style="background:rgb(170,130,30)"></div><span>Fair (‚àí110 to ‚àí120)</span></div>
            <div class="legend-item"><div class="legend-color" style="background:rgb(120,100,50)"></div><span>Poor (&lt;‚àí120)</span></div>
        </div>

        <div class="legend" style="margin-top:12px">
            <h3>‚ö° Interference</h3>
            <div class="legend-item"><div class="legend-color" style="background:rgb(160,0,0)"></div><span>Co-channel / cross-tech</span></div>
            <div class="legend-item"><div class="legend-color" style="background:rgb(255,51,51)"></div><span>Power Meter interferer</span></div>
        </div>
    </div>

    <script src="/static/app.js?v=9"></script>
</body>
</html>
